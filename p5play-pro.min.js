/**
 * p5play-pro
 * @version 0.0
 * @author quinton-ashley
 * @license CC BY-NC-ND 4.0
 */
p5.prototype.registerMethod("init",(function(){let e=this;this.Netcode=class{constructor(){this.typeSizes={boolean:1,Uint8:1,Vec2_boolean:1,Float16:2,number:2,color:4,Float32:4,Int32:4,Vec2:4,Float64:8},this.player=0,this.encodeFloat16=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(n){e[0]=n;let i=t[0],o=i>>16&32768,s=i>>12&2047,l=i>>23&255;return l<103?o:l>142?(o|=31744,o|=(255==l?0:1)&&8388607&i,o):l<113?(s|=2048,o|=(s>>114-l)+(s>>113-l&1),o):(o|=l-112<<10|s>>1,o+=1&s,o)}}()}decodeFloat16(e){let t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}connect(){}disconnect(){}spriteToBinary(t){const n=e.Sprite.props;let i=3;for(let o=0;o<n.length;o++){if(t.watch&&!t.mod[o])continue;const s=n[o],l=e.Sprite.propTypes[s];let r=t[s];if(null!=r)if("string"==l){i+=(new TextEncoder).encode(r).length+3}else i+=this.typeSizes[l]+1}if(3==i)return null;const o=new ArrayBuffer(i),s=new DataView(o);s.setFloat16=(e,t)=>s.setUint16(e,this.encodeFloat16(t)),s.setUint16(0,t._uid);let l=2;for(let i=0;i<n.length;i++){if(t.watch&&!t.mod[i])continue;const o=n[i],r=e.Sprite.propTypes[o];let a=t[o];if(null!=a){if(s.setUint8(l,i),l+=1,"boolean"==r)s.setUint8(l,a?1:0);else if("number"==r||"Float16"==r)"rotation"==o&&(a>2048||a<-2048)&&(a%=2048,t[o]=a),s.setFloat16(l,a);else if("Float32"==r)s.setFloat32(l,a);else if("Float64"==r)s.setFloat64(l,a);else{if("string"==r){const e=(new TextEncoder).encode(a);s.setUint16(l,e.length),l+=2;for(let t=0;t<e.length;t++)s.setUint8(l,e[t]),l+=1;continue}"color"==r?(s.setUint8(l,a.levels[0]),s.setUint8(l+1,a.levels[1]),s.setUint8(l+2,a.levels[2]),s.setUint8(l+3,a.levels[3])):"Vec2"==r?(s.setFloat16(l,a.x),s.setFloat16(l+2,a.y)):"Vec2_boolean"==r?s.setUint8(l,(a.x?1:0)|(a.y?2:0)):"Uint8"==r?"collider"==o?s.getUint8(l,t.__collider):"shape"==o?s.getUint8(l,t.__shape):s.getUint8(l,a):"Int32"==r&&s.setInt32(l,a)}l+=this.typeSizes[r]}}return s.setUint8(l,255),t.watch=!0,t.mod={},new Uint8Array(o)}spriteToBlob(e){const t=this.spriteToBinary(e);return new Blob([t])}binaryToSprite(t,n){let i;i=t instanceof DataView?t:new DataView(t.buffer),i.getFloat16=e=>this.decodeFloat16(i.getUint16(e));let o=n||0,s=i.getUint16(o);o+=2;let l=e.p5play.sprites[s]||new e.Sprite;for(;o!==i.byteLength;){const t=i.getUint8(o);if(255===t)break;o+=1;const n=e.Sprite.props[t],s=e.Sprite.propTypes[n];if("boolean"===s)l[n]=0!==i.getUint8(o);else if("number"==s||"Float16"===s)l[n]=i.getFloat16(o);else if("Float32"===s)l[n]=i.getFloat32(o);else if("Float64"===s)l[n]=i.getFloat64(o);else{if("string"===s){const e=i.getUint16(o);o+=2;const t=new Uint8Array(i.buffer,o,e);l[n]=(new TextDecoder).decode(t),o+=e;continue}if("color"===s){const e=i.getUint8(o),t=i.getUint8(o+1),s=i.getUint8(o+2),r=i.getUint8(o+3);l[n]=color(e,t,s,r)}else if("Vec2"===s){const e=i.getFloat16(o),t=i.getFloat16(o+2);l[n]={x:e,y:t}}else if("Vec2_boolean"===s){const e=i.getUint8(o);l[n]={x:!(1&~e),y:!(2&~e)}}else if("Uint8"===s){let t=i.getUint8(o);"collider"===n?l.collider=e.Sprite.colliderTypes[t]:"shape"===n?l.shape=e.Sprite.shapeTypes[t]:l[n]=t}else"Int32"===s&&(l[n]=i.getInt32(o))}o+=this.typeSizes[s]}return i.offset=o,l}async blobToSprite(e,t){const n=await e.arrayBuffer(),i=new Uint8Array(n);return this.binaryToSprite(i,t)}inputToJSON(){}},this.netcode=new this.Netcode,this.loadAds=e=>{e??={},window.webkit&&webkit.messageHandlers.loadAds.postMessage(JSON.stringify(e))},this.showAd=e=>{e&&(e=e.toLowerCase()),e??="interstitial",window.webkit&&confirm("p5play:"+e)}}));
